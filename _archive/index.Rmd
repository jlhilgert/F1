---
title: "Formula 1 Season Report"
author: "Author: Joao Lucas Hilgert"
date: "Compiled: `r Sys.setlocale('LC_TIME', 'English'); format(Sys.Date(), '%d %B %Y')`"
subtitle: "Version 1.2.1"
output:
  html_document:
    df_print: paged
    toc: true
    number_sections: true
    theme: cerulean
---

```{r libraries, include=FALSE}
library(httr)
library(XML)
library(stringr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(data.table)
library(plotly)
library(leaflet)
library(lubridate)

Sys.setlocale("LC_TIME", "English")
```

```{r Constants, include=FALSE}
round_var <- 1

lap_list <- readRDS("F1_lap_history2022.RDS")
driverResult <- readRDS("driverResult2022.RDS")
quali_df <- readRDS("quali_results.RDS")

year <- 2022

latest_round <- as.numeric(xmlToList(rawToChar(GET("http://ergast.com/api/f1/current/driverStandings")$content))$StandingsTable$StandingsList$.attrs["round"])
```

```{r Functions, include=FALSE}
getDriverStandings <- function(currentRound = "current", season = year) {
  
  if(currentRound == "current") {
    url <- "http://ergast.com/api/f1/current/driverStandings"
  } else {
    url <- paste("http://ergast.com/api/f1/", season, "/", currentRound,  "/driverStandings", sep = "")
  }
  
  temp <- xmlToList(rawToChar(GET(url)$content))
  
  round <- as.numeric(temp$StandingsTable$StandingsList$.attrs["round"])
  
  driver_standings <- data.frame()
  for(i in 1:(length(temp$StandingsTable$StandingsList)-1)) {
    driver_temp <- temp$StandingsTable$StandingsList[[i]]
    
    row_temp <- cbind(
      bind_rows(driver_temp$Driver[1:length(driver_temp$Driver)-1]),
      bind_rows(driver_temp$Driver$.attrs),
      bind_rows(driver_temp$Constructor[1:length(driver_temp$Constructor)-1]) %>%
        rename(Constructor = Name, TeamCountry = Nationality),
      bind_rows(driver_temp$Constructor$.attrs) %>%
        rename(TeamUrl = url),
      bind_rows(driver_temp$.attrs)
    )
    
    driver_standings <- rbind(driver_standings, row_temp)
  }
  
  driver_standings <- as.data.frame(driver_standings)
  
  driver_standings[,13:16] <- as.numeric(unlist(driver_standings[,13:16]))
  
  driver_standings <- driver_standings %>%
    mutate(FullName = paste(GivenName,FamilyName)) %>%
    relocate(FullName, .after = FamilyName) %>%
    mutate(ColorCode = 
             ifelse(
               Constructor == "Ferrari", "#DC0000",
                    ifelse(
                      Constructor == "Mercedes", "#00D2BE",
                      ifelse(
                        Constructor == "Red Bull", "#0600EF",
                             ifelse(
                               Constructor == "Alpine F1 Team", "#0090FF", 
                               ifelse(
                                 Constructor == "Haas F1 Team", "#999999",
                                 ifelse(
                                   Constructor == "Aston Martin", "#006F62",
                                   ifelse(
                                     Constructor == "AlphaTauri", "#2B4562",
                                     ifelse(
                                       Constructor == "McLaren", "#FF8700",
                                       ifelse(
                                         Constructor == "Alfa Romeo", "#900000",
                                         ifelse(
                                           Constructor == "Williams", "#005AFF", NA
                                         )
                                       )
                                     )
                                   )
                                 )
                               )
                             ))
                    ))
             )
  return(driver_standings)
}

plotLapTimes <- function(currentRound) {
  p1 <- ggplotly(
    ggplot(lap_list %>% filter(Round == currentRound), aes(x = lap, y = position, fill = code, color = Constructor)) +
      geom_line() +
      scale_y_continuous(trans = "reverse", breaks = unique(lap_list$position[lap_list$Round == currentRound])) +
      constructer_scale_colors +
      labs(x = "Lap", y = "Position", color = "Driver")
  )
  
  p2 <- ggplotly(
    ggplot(lap_list %>% filter(Round == currentRound), aes(x = lap, y = timeSecs, fill = code, color = Constructor)) +
      geom_line() +
      constructer_scale_colors +
      labs(x = "Lap", y = "Lap time (sec)", color = "Driver")
  )
  
  return(list(p1, p2))
}

getConstructerScaleColors <- function() {
  constructer_list <- unique(driver_standings %>% select(Constructor, ColorCode))

  constructer_scale_colors <- scale_colour_manual(
    values = c(
      "Red Bull" = constructer_list$ColorCode[constructer_list$Constructor == "Red Bull"], 
      "Ferrari" = constructer_list$ColorCode[constructer_list$Constructor == "Ferrari"], 
      "Mercedes" = constructer_list$ColorCode[constructer_list$Constructor == "Mercedes"], 
      "McLaren" = constructer_list$ColorCode[constructer_list$Constructor == "McLaren"], 
      "Alpine F1 Team" = constructer_list$ColorCode[constructer_list$Constructor == "Alpine F1 Team"], 
      "Alfa Romeo" = constructer_list$ColorCode[constructer_list$Constructor == "Alfa Romeo"], 
      "Haas F1 Team" = constructer_list$ColorCode[constructer_list$Constructor == "Haas F1 Team"], 
      "AlphaTauri" = constructer_list$ColorCode[constructer_list$Constructor == "AlphaTauri"], 
      "Aston Martin" = constructer_list$ColorCode[constructer_list$Constructor == "Aston Martin"], 
      "Williams" = constructer_list$ColorCode[constructer_list$Constructor == "Williams"]
      )
    )
  
  return(constructer_scale_colors)
}

plotGPMap <- function(round) {
  if(round == "Season") {
    lat <- 10
    long <- 20
    zoom <- 2
    weight <- 8
    GP_df <- grandPrixRounds
  } else {
    lat <- grandPrixRounds$lat[grandPrixRounds$Round == round]
    long <- grandPrixRounds$long[grandPrixRounds$Round == round]
    zoom <- 5
    weight <- 20
    GP_df <- grandPrixRounds[grandPrixRounds$Round == round,]
  }
  
  map <- leaflet() %>% 
  setView(lat = lat, lng = long, zoom = zoom) %>%
  addTiles(group = "Map")  %>% 
  addCircles(data = GP_df, lat = ~lat, lng = ~long, weight = weight,fillOpacity = 0.8, color = "red", popup = ~paste("Round ", Round, " - ", Locality, ", ", Country,  sep = ""), label = ~RaceName, group = "Grand Prix") %>%
  addProviderTiles("Esri.WorldImagery", group = "Satelite") %>%
  addProviderTiles("Stamen.Watercolor", group = "Watercolor") %>%
  addProviderTiles("CartoDB.DarkMatterNoLabels", group = "Dark") %>%
  addProviderTiles("Stamen.TerrainLabels", group = "Labels") %>%
  addLayersControl(
    baseGroups = c("Satelite","Map", "Dark", "Watercolor"),
    overlayGroups = c("Labels", "Grand Prix"),
    options = layersControlOptions(collapsed = TRUE),
    position = "topleft"
  )
  
  return(map)
}
```

```{r Large Dataset Download, eval=FALSE, include=FALSE}
# All driver results
driverResult <- data.frame()
for(i in 1:latest_round) {
  url <- paste("http://ergast.com/api/f1/current/", i, "/results", sep = "")
  temp <- xmlToList(rawToChar(GET(url)$content))
  
  driverResult_GP <- data.frame()
  for(j in 1:length(temp$RaceTable$Race$ResultsList)) {
    driverResult_ind <- temp$RaceTable$Race$ResultsList[j]
    result_temp <- cbind(
      bind_rows(driverResult_ind$Result$Driver[1:3]),
      bind_rows(driverResult_ind$Result$Driver$.attrs[1:2]),
      bind_rows(driverResult_ind$Result$Constructor[1]) %>% rename(Constructor = Name),
      bind_rows(driverResult_ind$Result$.attrs[c(2,4)]),
      bind_rows(driverResult_ind$Result[3:4]) %>% mutate(Grid = as.numeric(Grid), Laps = as.numeric(Laps)) %>% rename(StartingPos = Grid),
      bind_rows(driverResult_ind$Result$Status[1]) %>% rename(Status = text),
      if(is.null(driverResult_ind$Result$Time$.attrs)) {tibble(Time_sec = NA)} else {
        bind_rows(driverResult_ind$Result$Time$.attrs) %>% mutate(millis = as.numeric(millis) / 1000) %>% rename(Time_sec = millis)
        },
      if(is.null(driverResult_ind$Result$FastestLap[1])) {tibble(FastestLap = NA)} else {
        bind_rows(driverResult_ind$Result$FastestLap[1]) %>% mutate(Time = as.numeric(str_split(Time, ":")[[1]][1]) * 60 + as.numeric(str_split(Time, ":")[[1]][2])) %>% rename(FastestLap = Time)
        },
      if(is.null(driverResult_ind$Result$FastestLap$.attrs[1])) {tibble(rank = NA)} else {
        bind_rows(driverResult_ind$Result$FastestLap$.attrs[1]) %>% mutate(rank = as.numeric(rank))
        },
      if(is.null(driverResult_ind$Result$FastestLap$AverageSpeed[1])) {tibble(avgSpeedKph = NA)} else {
        bind_rows(driverResult_ind$Result$FastestLap$AverageSpeed[1]) %>% mutate(text = as.numeric(text)) %>% rename(avgSpeedKph = text)
        }
    ) %>%
      mutate(Round = i) %>%
      relocate(Round, .before = position) %>%
      mutate(
        StartingPos = ifelse(StartingPos == 0, NA, StartingPos),
        FullName = paste(GivenName, FamilyName)
        ) %>% relocate(FullName, .after = FamilyName)
    
    driverResult_GP <- rbind(driverResult_GP, result_temp)
  }
  
  driverResult <- rbind(driverResult, driverResult_GP)
  
  print(paste("Round", i, "of", latest_round, sep = " "))
  
  Sys.sleep(0.5)
}

saveRDS(driverResult, "driverResult2022.RDS")

# All lap results
lap_list <- data.frame()
for(j in 1:latest_round) {
  lap_list_temp <- data.frame()
  
  print(paste("Round", j, "of", latest_round, sep = " "))
  
  for(i in 1:100) {
    url <- paste("https://ergast.com/api/f1/current/", j, "/laps/", i, sep = "")
    
    temp <- xmlToList(rawToChar(GET(url)$content))
    
    if(is.null(temp$RaceTable$Race$LapsList)) {
      break
    } else {
      lap_temp <- bind_rows(temp$RaceTable$Race$LapsList[[1]]) %>%
        select(-number)
      lap_list_temp <- rbind(lap_list_temp,lap_temp)
      
      print(paste("Lap", i))
      Sys.sleep(0.5)
    }
  }
  
  lap_list_temp$Round <- j
  
  lap_list <- rbind(lap_list, lap_list_temp)
}

lap_list <- lap_list %>%
  drop_na()

timeSecs_temp <- c()
for (i in 1:length(lap_list$time)) {
  timeSecs_temp <-c(timeSecs_temp,
  as.numeric(str_split(lap_list$time[i], ":")[[1]][1]) * 60 + as.numeric(str_split(lap_list$time[i], ":")[[1]][2])
  )
}

lap_list <- lap_list %>%
  mutate(position = as.numeric(position),lap = as.numeric(lap), timeSecs = timeSecs_temp) %>%
  left_join(
    driver_standings %>%
      select(driverId, Constructor, code)
  )

saveRDS(lap_list, "F1_lap_history2022.RDS")

# Qualifying results
quali_df <- data.frame()
for(i in 1:latest_round) {
  url <- paste("http://ergast.com/api/f1/", year, "/", i, "/qualifying", sep = "")

  temp <- xmlToList(rawToChar(GET(url)$content))
  
  qualy_df_temp <- data.frame()
  for(j in 1:length(temp$RaceTable$Race$QualifyingList)) {
    qualifyingDriver <- temp$RaceTable$Race$QualifyingList[j]
  
    qualy_temp <- cbind(
      bind_rows(qualifyingDriver$QualifyingResult$Driver[c(2,3,5)]) %>% mutate(FullName = paste(GivenName, FamilyName)) %>% relocate(FullName, .after = FamilyName) %>% select(-c("GivenName", "FamilyName")),
      bind_rows(qualifyingDriver$QualifyingResult$Driver$.attrs["code"]),
      bind_rows(qualifyingDriver$QualifyingResult$Constructor["Name"]) %>% rename(Constructor = Name),
      if(is.null(qualifyingDriver$QualifyingResult["Q1"][[1]])) {tibble(Q1 = NA)} else {
        bind_rows(qualifyingDriver$QualifyingResult["Q1"])
      },
      if(is.null(qualifyingDriver$QualifyingResult["Q2"][[1]])) {tibble(Q2 = NA)} else {
        bind_rows(qualifyingDriver$QualifyingResult["Q2"])
      },
      if(is.null(qualifyingDriver$QualifyingResult["Q3"][[1]])) {tibble(Q3 = NA)} else {
        bind_rows(qualifyingDriver$QualifyingResult["Q3"])
      }
    ) %>% mutate(Round = i) %>% relocate(Round, .before = FullName)
    
    qualy_df_temp <- rbind(qualy_df_temp, qualy_temp)
  }
  
  print(paste("Round", i, "of", latest_round))
  
  quali_df <- rbind(quali_df,qualy_df_temp)
  
  Sys.sleep(0.5)

}

saveRDS(quali_df, "quali_results.RDS")
```

```{r Update Large Datasets, include=FALSE}
# All driver results
if (max(driverResult$Round) < latest_round) {
  for(i in (max(driverResult$Round)+1):latest_round) {
    url <- paste("http://ergast.com/api/f1/current/", i, "/results", sep = "")
    temp <- xmlToList(rawToChar(GET(url)$content))
    
    driverResult_GP <- data.frame()
    for(j in 1:length(temp$RaceTable$Race$ResultsList)) {
      driverResult_ind <- temp$RaceTable$Race$ResultsList[j]
      result_temp <- cbind(
        bind_rows(driverResult_ind$Result$Driver[1:3]),
        bind_rows(driverResult_ind$Result$Driver$.attrs[1:2]),
        bind_rows(driverResult_ind$Result$Constructor[1]) %>% rename(Constructor = Name),
        bind_rows(driverResult_ind$Result$.attrs[c(2,4)]),
        bind_rows(driverResult_ind$Result[3:4]) %>% mutate(Grid = as.numeric(Grid), Laps = as.numeric(Laps)) %>% rename(StartingPos = Grid),
        bind_rows(driverResult_ind$Result$Status[1]) %>% rename(Status = text),
        if(is.null(driverResult_ind$Result$Time$.attrs)) {tibble(Time_sec = NA)} else {
          bind_rows(driverResult_ind$Result$Time$.attrs) %>% mutate(millis = as.numeric(millis) / 1000) %>% rename(Time_sec = millis)
          },
        if(is.null(driverResult_ind$Result$FastestLap[1])) {tibble(FastestLap = NA)} else {
          bind_rows(driverResult_ind$Result$FastestLap[1]) %>% mutate(Time = as.numeric(str_split(Time, ":")[[1]][1]) * 60 + as.numeric(str_split(Time, ":")[[1]][2])) %>% rename(FastestLap = Time)
          },
        if(is.null(driverResult_ind$Result$FastestLap$.attrs[1])) {tibble(rank = NA)} else {
          bind_rows(driverResult_ind$Result$FastestLap$.attrs[1]) %>% mutate(rank = as.numeric(rank))
          },
        if(is.null(driverResult_ind$Result$FastestLap$AverageSpeed[1])) {tibble(avgSpeedKph = NA)} else {
          bind_rows(driverResult_ind$Result$FastestLap$AverageSpeed[1]) %>% mutate(text = as.numeric(text)) %>% rename(avgSpeedKph = text)
          }
      ) %>%
        mutate(Round = i) %>%
        relocate(Round, .before = position) %>%
        mutate(
          StartingPos = ifelse(StartingPos == 0, NA, StartingPos),
          FullName = paste(GivenName, FamilyName)
          ) %>% relocate(FullName, .after = FamilyName)
      
      driverResult_GP <- rbind(driverResult_GP, result_temp)
    }
    
    driverResult <- rbind(driverResult, driverResult_GP)
    
    print(paste("Round", i, "of", latest_round, sep = " "))
    
    Sys.sleep(0.5)
  }
  
  saveRDS(driverResult, "driverResult2022.RDS")
}

# All lap results
if (max(lap_list$Round) < latest_round) {
  for(j in (max(lap_list$Round)+1):latest_round) {
    lap_list_temp <- data.frame()
    
    print(paste("Round", j, "of", latest_round, sep = " "))
    
    for(i in 1:100) {
      url <- paste("https://ergast.com/api/f1/current/", j, "/laps/", i, sep = "")
      
      temp <- xmlToList(rawToChar(GET(url)$content))
      
      if(is.null(temp$RaceTable$Race$LapsList)) {
        break
      } else {
        lap_temp <- bind_rows(temp$RaceTable$Race$LapsList[[1]]) %>%
          select(-number)
        lap_list_temp <- rbind(lap_list_temp,lap_temp)
        
        print(paste("Lap", i))
        Sys.sleep(0.5)
      }
    }
    
    lap_list_temp$Round <- j
    
    timeSecs_temp <- c()
    for (k in 1:length(lap_list_temp$time)) {
      timeSecs_temp <-c(timeSecs_temp,
      as.numeric(str_split(lap_list_temp$time[k], ":")[[1]][1]) * 60 + as.numeric(str_split(lap_list_temp$time[k], ":")[[1]][2])
      )
    }
    
    lap_list_temp <- lap_list_temp %>%
    mutate(position = as.numeric(position),lap = as.numeric(lap), timeSecs = timeSecs_temp) %>%
    left_join(
      driver_standings %>%
        select(driverId, Constructor, code)
    )
    
    lap_list <- rbind(lap_list, lap_list_temp)
  }
  
  lap_list <- lap_list %>%
    drop_na()
  
  saveRDS(lap_list, "F1_lap_history2022.RDS")
}


# Qualifying results
if (max(quali_df$Round) < latest_round) {

  for(i in (max(quali_df$Round)+1):latest_round) {
    url <- paste("http://ergast.com/api/f1/", year, "/", i, "/qualifying", sep = "")
  
    temp <- xmlToList(rawToChar(GET(url)$content))
    
    qualy_df_temp <- data.frame()
    for(j in 1:length(temp$RaceTable$Race$QualifyingList)) {
      qualifyingDriver <- temp$RaceTable$Race$QualifyingList[j]
    
      qualy_temp <- cbind(
        bind_rows(qualifyingDriver$QualifyingResult$Driver[c(2,3,5)]) %>% mutate(FullName = paste(GivenName, FamilyName)) %>% relocate(FullName, .after = FamilyName) %>% select(-c("GivenName", "FamilyName")),
        bind_rows(qualifyingDriver$QualifyingResult$Driver$.attrs["code"]),
        bind_rows(qualifyingDriver$QualifyingResult$Constructor["Name"]) %>% rename(Constructor = Name),
        if(is.null(qualifyingDriver$QualifyingResult["Q1"][[1]])) {tibble(Q1 = NA)} else {
          bind_rows(qualifyingDriver$QualifyingResult["Q1"])
        },
        if(is.null(qualifyingDriver$QualifyingResult["Q2"][[1]])) {tibble(Q2 = NA)} else {
          bind_rows(qualifyingDriver$QualifyingResult["Q2"])
        },
        if(is.null(qualifyingDriver$QualifyingResult["Q3"][[1]])) {tibble(Q3 = NA)} else {
          bind_rows(qualifyingDriver$QualifyingResult["Q3"])
        }
      ) %>% mutate(Round = i) %>% relocate(Round, .before = FullName)
      
      qualy_df_temp <- rbind(qualy_df_temp, qualy_temp)
    }
    
    print(paste("Round", i, "of", latest_round))
    
    quali_df <- rbind(quali_df,qualy_df_temp)
    
    Sys.sleep(0.5)
  
  }
  
  saveRDS(quali_df, "quali_results.RDS")
}
```


```{r include=FALSE}
driver_standings <- getDriverStandings()

constructer_list <- unique(driver_standings %>% select(Constructor, ColorCode))

constructer_scale_colors <- getConstructerScaleColors()
```

```{r include=FALSE}
# Grand Prix Rounds
url <- "http://ergast.com/api/f1/current"

temp <- xmlToList(rawToChar(GET(url)$content))

grandPrixRounds <- data.frame()
for(i in 1:(length(temp$RaceTable)-1)) {
  circuit_temp <- temp$RaceTable[i]
  
  row_temp <- cbind(
    as.numeric(circuit_temp$Race$.attrs["round"]),
    bind_rows(circuit_temp$Race[c(1,3)]),
    circuit_temp$Race$Circuit$CircuitName,
    bind_rows(circuit_temp$Race$Circuit$Location[1:2]),
    bind_rows(circuit_temp$Race$Circuit$Location$.attrs),
    circuit_temp$Race$.attrs["url"]
  ) %>%
    rename(
      CircuitName = "circuit_temp$Race$Circuit$CircuitName",
      Round = "as.numeric(circuit_temp$Race$.attrs[\"round\"])",
      url = 'circuit_temp$Race$.attrs["url"]'
      )
  
  grandPrixRounds <- rbind(grandPrixRounds, row_temp)
}

grandPrixRounds <- grandPrixRounds %>%
  mutate(pointsFirst = ifelse(
    Locality %in% c(
      "Imola",
      "Spielberg",
      "São Paulo"
    ),
    32,
    26
  )) %>%
  mutate(pointsSecond = ifelse(
    Locality %in% c(
      "Imola",
      "Spielberg",
      "São Paulo"
    ),
    25,
    20
  )) %>%
  mutate(pointsThird = ifelse(
    Locality %in% c(
      "Imola",
      "Spielberg",
      "São Paulo"
    ),
    21,
    15
  )) %>%
  mutate(lat = as.numeric(lat), long = as.numeric(long))
```

```{r include=FALSE}
pointsLeft <- sum(grandPrixRounds$pointsFirst[grandPrixRounds$Round > latest_round])
pointsSecond <- sum(grandPrixRounds$pointsSecond[grandPrixRounds$Round > latest_round])
pointsThird <- sum(grandPrixRounds$pointsThird[grandPrixRounds$Round > latest_round])

prospectTable <- driver_standings %>%
  select(FullName,code,Constructor,position,points) %>%
  mutate(distToFirst = driver_standings$points[driver_standings$position==1] - points) %>%
  mutate(pointsMaximiz = pointsLeft - distToFirst) %>%
  mutate(pointsVsSecond = ifelse(
    position == 1, NA, pointsLeft - (distToFirst+pointsSecond)
  )) %>%
  mutate(pointsVsThird = ifelse(
    position == 1, NA, pointsLeft - (distToFirst+pointsThird)
  )) %>%
  rename(
    `distToFirst*` = distToFirst,
    `pointsMaximiz**` = pointsMaximiz,
    `pointsVsSecond***` = pointsVsSecond,
    `pointsVsThird****` = pointsVsThird
  )
```

```{r eval=FALSE, include=FALSE}
#<hr style="border:2px solid lightblue">
```

---

# [**Season**](https://en.wikipedia.org/wiki/2022_Formula_One_World_Championship) {.tabset .tabset-fade .tabset-pills .unnumbered}

## Grand Prix {.unnumbered}

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap("Season")
```

## Calendar {.unnumbered}

```{r echo=FALSE}
rownames(grandPrixRounds) <- c()

DT::datatable(
  grandPrixRounds %>%
  mutate(Date2 = format(as.Date(Date), format="%b %d")) %>%
  mutate(Date = Date2) %>%
  select(Round, RaceName, Date, CircuitName, Locality, Country),
options = list(pageLength = 25),
rownames= FALSE
)
```


---

## Current Driver Standings {.unnumbered}

```{r echo=FALSE}
driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber)

DT::datatable(driver_standings_current, options = list(pageLength = 25))
```

---

## Driver Points Development {.unnumbered}

```{r include=FALSE}
driver_standings_season <- data.frame()
for(i in 1:latest_round) {
  driver_standings_current <- getDriverStandings(i) %>%
    mutate(Round = i) %>%
    select(Round, FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
    rename(Num = PermanentNumber)
  
  driver_standings_season <- rbind(driver_standings_season, driver_standings_current)
}

constructors_standings_season <- data.frame()
for(i in 1:latest_round) {
  driver_standings_current <- getDriverStandings(i) %>%
    mutate(Round = i) %>%
    select(Round, FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
    rename(Num = PermanentNumber)
  
  driver_standings_season <- rbind(driver_standings_season, driver_standings_current)
}
```

```{r echo=FALSE, fig.height=7, fig.width=9}
ggplotly(
    ggplot(driver_standings_season, aes(x = Round, y = points, fill = code, color = Constructor)) +
      geom_line() +
      constructer_scale_colors +
      labs(x = "Round", y = "Points", color = "Driver")
  )
```

---

## Position (WDC) Development {.unnumbered}

```{r echo=FALSE, fig.height=7, fig.width=9}
ggplotly(
    ggplot(driver_standings_season, aes(x = Round, y = position, fill = code, color = Constructor)) +
      geom_line() +
      scale_y_continuous(trans = "reverse", breaks = unique(driver_standings_season$position)) +
      constructer_scale_colors +
      labs(x = "Round", y = "Position", color = "Driver")
  )
```

---

## Starting Position Development {.unnumbered}

```{r echo=FALSE, fig.height=7, fig.width=9}
ggplotly(
    ggplot(driverResult, aes(x = Round, y = StartingPos, fill = code, color = Constructor)) +
      geom_line() +
      scale_y_continuous(trans = "reverse", breaks = unique(driverResult$StartingPos)) +
      constructer_scale_colors +
      labs(x = "Round", y = "Position", color = "Driver")
  )
```

---

## Championship forecast {.unnumbered}

```{r echo=FALSE}
DT::datatable(
  prospectTable,
options = list(pageLength = 25)
)
```

<span style="font-size:12px">\*Distance to the driver in the first position, i.e. `r driver_standings$FullName[driver_standings$position==1]` (`r driver_standings$code[driver_standings$position==1]`).</span>  
<span style="font-size:12px">\*\*Points at the end of the season if driver wins the maximum amount of points available and `r driver_standings$code[driver_standings$position==1]` does not score a single point.</span>  
<span style="font-size:12px">\*\*\*Points at the end of the season if driver wins the maximum amount of points available and `r driver_standings$code[driver_standings$position==1]` achieves P2 in every remaining race (including sprint races).</span>  
<span style="font-size:12px">\*\*\*\*Points at the end of the season if driver wins the maximum amount of points available and `r driver_standings$code[driver_standings$position==1]` achieves P3 in every remaining race (including sprint races).</span>  

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 1, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```

## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 2, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```


---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 3, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 4, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 5, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 6, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 7, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 8, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 9, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 10, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 11, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 12, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 13, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# <b>- [`r grandPrixRounds$RaceName[grandPrixRounds$Round == round_var]`](`r grandPrixRounds$url[round_var]`)</b> {.tabset .tabset-fade .tabset-pills}

```{r Round 14, eval=FALSE, include=FALSE}
#placeholder
```

```{r include=FALSE}
winner_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor))]
pole_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(Constructor))]
fastest_lap_hex <- constructer_list$ColorCode[constructer_list$Constructor == as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor))]
```


**Winner:** <span style="background-color:`r winner_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(position == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span> <br>

**Pole:** <span style="background-color:`r pole_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(StartingPos == 1) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var, StartingPos == 1) %>% select(Constructor)), ")", sep = "")`&nbsp;</span>  <br>

**Fastest Lap:** <span style="background-color:`r fastest_lap_hex`;color:white">&nbsp;`r paste(as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(code)), " (", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(Constructor)), ") - ", as.character(driverResult %>% filter(Round == round_var) %>% filter(FastestLap == min(FastestLap, na.rm = T)) %>% select(FastestLap)), "s", sep = "")`&nbsp;</span>

```{r echo=FALSE}
driver_standings <- getDriverStandings(round_var)

driver_standings_current <- driver_standings %>%
  select(FullName, code, PermanentNumber, Nationality, Constructor, position, points, wins) %>%
  rename(Num = PermanentNumber) %>%
  relocate(position, .before = FullName)
```


## Location

```{r echo=FALSE, fig.height=7, fig.width=9}
plotGPMap(round_var)
```

---

## Race Result

```{r echo=FALSE}
DT::datatable(
driverResult %>%
  filter(Round == round_var) %>%
  select(code, FullName, Constructor, position, StartingPos, points, Laps, Status, FastestLap, avgSpeedKph), 
options = list(pageLength = 25)
)
```

---

## Qualifying Results

```{r echo=FALSE}
DT::datatable(
quali_df[quali_df$Round == round_var,] %>% select(-c("Round", "Nationality")),
options = list(pageLength = 25)
)
```

---

## Track Position Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots <- plotLapTimes(round_var)

lapPlots[[1]]
```

---

## Lap Time Development

```{r echo=FALSE, fig.height=7, fig.width=9}
lapPlots[[2]]
```

---

## WDC Standings

```{r echo=FALSE}
DT::datatable(driver_standings_current, options = list(pageLength = 25), rownames = F)
```

```{r include=FALSE}
round_var <- round_var + 1
```

---

# Data Source: {.unnumbered}
**[Ergast Developer API](http://ergast.com/mrd/)**